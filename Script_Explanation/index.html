
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for ChromCompare">
      
      
        <meta name="author" content="Sam Fletcher">
      
      
      
        <link rel="prev" href="../Heatmaps/">
      
      
      
      <link rel="icon" href="../logo.svg">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.4">
    
    
      
        <title>Main Script Explanation - ChromCompare Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.8608ea7d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#main-script-explanation" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="ChromCompare Documentation" class="md-header__button md-logo" aria-label="ChromCompare Documentation" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ChromCompare Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Main Script Explanation
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/sof202/ChromCompare" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="ChromCompare Documentation" class="md-nav__button md-logo" aria-label="ChromCompare Documentation" data-md-component="logo">
      
  <img src="../logo.svg" alt="logo">

    </a>
    ChromCompare Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/sof202/ChromCompare" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome to the ChromCompare wiki
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Heatmaps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Heatmap Plotting
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Main Script Explanation
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Main Script Explanation
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      The metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emission-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Emission similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spatial-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Spatial similarity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spatial similarity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formula" class="md-nav__link">
    <span class="md-ellipsis">
      Formula
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#margins" class="md-nav__link">
    <span class="md-ellipsis">
      Margins
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combination-process" class="md-nav__link">
    <span class="md-ellipsis">
      Combination process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Combination process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deciding-on-weights" class="md-nav__link">
    <span class="md-ellipsis">
      Deciding on weights
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#the-metrics" class="md-nav__link">
    <span class="md-ellipsis">
      The metrics
    </span>
  </a>
  
    <nav class="md-nav" aria-label="The metrics">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#emission-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Emission similarity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#spatial-similarity" class="md-nav__link">
    <span class="md-ellipsis">
      Spatial similarity
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Spatial similarity">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#formula" class="md-nav__link">
    <span class="md-ellipsis">
      Formula
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#margins" class="md-nav__link">
    <span class="md-ellipsis">
      Margins
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#combination-process" class="md-nav__link">
    <span class="md-ellipsis">
      Combination process
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Combination process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deciding-on-weights" class="md-nav__link">
    <span class="md-ellipsis">
      Deciding on weights
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="main-script-explanation">Main Script Explanation</h1>
<p>The main script found in <code>.../JobSubmission/</code> creates a variety of similarity
metrics for your chosen two ChromHMM models and combines these into a single
metric for you to [interpret].</p>
<h2 id="the-metrics">The metrics</h2>
<p>There are two types of metrics that are produced by this script. One tackles
how similar the emission parameters are between each pair of states between the
two models, whilst the other aims to assess the spatial similarity. Both are
an obvious requirement when comparing states between two models (as these 
are the two main features of hidden Markov models).</p>
<h3 id="emission-similarity">Emission similarity</h3>
<p>To keep in line with tools like
<a href="https://github.com/sof202/ChromOptimise">ChromOptimise</a> and
<a href="https://compbio.mit.edu/ChromHMM/">ChromHMM</a>, states between the two models
are compared using Euclidean distance. State pairs that have a small Euclidean
distance between them are similar as they signify a similar combination of
epigenetic marks.</p>
<h3 id="spatial-similarity">Spatial similarity</h3>
<p>WARNING: For spatial similarity to make sense, both models must be trained on
the same genome build.</p>
<p>Spatial similarity is the feature not natively present in ChromHMM's command
list. Considering HMM models can have multiple states with very similar
emission parameters, emission similarity isn't enough to make sound comparisons
between the states of two models (<em>i.e.</em> as 2 states in model A may match with
1 state from model B, making it difficult to tell which pair is most
applicable). </p>
<p>Spatial similarity is calculated by the use of fold enrichment, the formula for
which is taken from ChromHMM (as ChromHMM uses this for enrichment in known
genomic features like CGIs). The formula is applied to each state pair between
the two models, such that a higher value implies the two states tend to occupy
the same regions of the genome. Uncertainty is somewhat baked into this formula
and so extraordinary large numbers will only be observed when there is an exact
match between two states that are both very rare.</p>
<h4 id="formula">Formula</h4>
<p>As mentioned, this formula is taken directly from ChromHMM. It is defined by:</p>
<p>(C/A)/(B/D)</p>
<p>Where:</p>
<ul>
<li>A is the number of bases in the reference state</li>
<li>B is the number of bases in the comparison state</li>
<li>C is the number of bases in the overlap in the reference state and the
comparison state</li>
<li>D is the number of bases in the genome</li>
</ul>
<h4 id="margins">Margins</h4>
<p>Due to the nature of hidden Markov model training, spatial similarity between
two states can be ruined by a slight shift in state assignment (especially when
smaller bin sizes are used). For example, consider the following:</p>
<p>---xxx---xxx---xxx</p>
<p>000---000---000---</p>
<p>If the bin size used above was 20bp, the state 'x' in the first model could
be considered to be similar is spatial assignment to state '0' in the second.
However, under the fold enrichment formula, there is <strong>no</strong> spatial similarity
reported at all.</p>
<p>To get around this quirk, ChromCompare allows you to add a buffer region around
each state to increase the fold enrichment. Although this will increase the
fold enrichment for every state pair (especially is the margins are very
large), situations like the above will recieve higher fold enrichments over
others.</p>
<p>The configuration file created during
<a href="https://github.com/sof202/ChromCompare/tree/main#setup">setup</a> allows you to
find spatial similarities for any number of different margin sizes. It is
recommended to at least have one spatial similarity score calculated using a
margin. For this margin, we recommend to use the same value as the bin size
used when training the models (if the models use different bin sizes, pick the 
smaller of the two).</p>
<h2 id="combination-process">Combination process</h2>
<p>After calculating similarity metrics for both spatial and emission properties,
the final step of the main script is to combine all of these into one single
score (for interpretability). Each similarity score is stored in matrix form
(where each value corresponds with the similarity score between the state pair
given by the row and column number) and a linear combination is calculated
using <a href="#deciding-on-weights">user specified weights</a>. </p>
<p>There is however one small problem that needs to be addressed before taking a
linear combination. The score given by emission similarity favours a smaller
number (closer in Euclidean distance) and the spatial similarity score favours
a greater number (higher fold enrichment). In order to make these compatible, a
transformation is applied to the emission similarity score matrix which is
given by:</p>
<p>E = s_max * (1 - e/e_max)</p>
<p>Where:</p>
<ul>
<li>E is the new emission similarity matrix</li>
<li>e is the old emission similarity matrix</li>
<li>e_max is the maximum emission similarity (highest Euclidean distance)</li>
<li>s_max is the maximum spatial similarity (highest fold enrichment over all
matrices)</li>
</ul>
<h3 id="deciding-on-weights">Deciding on weights</h3>
<p>There isn't any concrete guidance on how to decide upon what weights to use
here just yet. This is because the decisions you make will be influenced by
what you are exactly looking for. In general, we suggest that the emissions
similarity matrix accounts for most of the weight as this is the most concrete
measure of similarity. Then, for the spatial similarity matrices, larger
margins should be favoured less (smaller weights) as values will be naturally
inflated.</p>
<p>It is likely that you will need to use wildly different weights depending on
the two models you are comparing and the original datasets you are using. For
example, if you trained one model with a bin size of 300 and the other with
200, you would expect states to tend to not line up (due to the 100bp
discrepency). As such a margin size of 100bp (or 200bp) would be favoured more
than usual (perhaps more than the scores without margins). </p>
<p>Turning on <code>$DEBUG_MODE</code> in the config file will allow you to look at the
intermediate similarity matrices (before they are combined), which may assist
you in deciding which metrics are more useful.</p>
<p>It should be noted that these similarity metrics are purely heuristic and
should used with caution. The main purpose of the information produced by these
scripts is to assist you with later analysis. It can be helpful to know that
state xxx in model A has no suitable comparison to any state in model B. It can
be useful to know that although state xxx in model A has similar emission
parameters to states yyy and zzz in model B, a better state pair should be
between xxx and yyy due to their fold enrichment.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      © 2024, Sam Fletcher
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.f1b6f286.min.js"></script>
      
    
  </body>
</html>